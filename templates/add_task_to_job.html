{##}
{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>{{ job.title }} - Job Details</title>#}
{#    <!-- Bootstrap CSS -->#}
{#    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">#}
{#    <!-- Font Awesome -->#}
{#    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">#}
{#    <style>#}
{#        .task-card {#}
{#            border-left: 4px solid #ccc;#}
{#            transition: all 0.3s ease;#}
{#        }#}
{#        .task-card:hover {#}
{#            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);#}
{#        }#}
{#        .task-status-green {#}
{#            border-left-color: #28a745;#}
{#        }#}
{#        .task-status-yellow {#}
{#            border-left-color: #ffc107;#}
{#        }#}
{#        .task-status-red {#}
{#            border-left-color: #dc3545;#}
{#        }#}
{#        .task-status-overdue {#}
{#            border-left-color: #6c757d;#}
{#            background-color: #f8d7da;#}
{#        }#}
{#        .progress {#}
{#            height: 20px;#}
{#        }#}
{#        .follow-task {#}
{#            border-left: 4px solid #27ae60;#}
{#        }#}
{#        .monthly-task {#}
{#            border-left: 4px solid #3498db;#}
{#        }#}
{#        .simple-task {#}
{#            border-left: 4px solid #e0e4e8;#}
{#        }#}
{##}
{#        /* Sheet view styling */#}
{#        .view-toggle-btn {#}
{#            border-radius: 0;#}
{#            text-transform: uppercase;#}
{#            font-size: 0.8rem;#}
{#            font-weight: 600;#}
{#            letter-spacing: 0.5px;#}
{#        }#}
{#        .progress-cell-0 { background-color: rgba(39, 174, 96, 0.1); }#}
{#        .progress-cell-25 { background-color: rgba(39, 174, 96, 0.35); }#}
{#        .progress-cell-50 { background-color: rgba(39, 174, 96, 0.55); }#}
{#        .progress-cell-75 { background-color: rgba(39, 174, 96, 0.75); }#}
{#        .progress-cell-100 { background-color: rgba(39, 174, 96, 0.95); }#}
{#    </style>#}
{#</head>#}
{#<body>#}
{#    <div class="container py-4">#}
{#        <!-- Job Header and Information -->#}
{#        <div class="row mb-4">#}
{#            <div class="col-md-12">#}
{#                <div class="card">#}
{#                    <div class="card-header bg-primary text-white">#}
{#                        <div class="d-flex justify-content-between align-items-center">#}
{#                            <h3 class="mb-0">{{ job.title }}</h3>#}
{#                            <div>#}
{#                                <a href="{% url 'job_list' %}" class="btn btn-sm btn-outline-light">#}
{#                                    <i class="fas fa-arrow-left"></i> Back to Jobs#}
{#                                </a>#}
{#                                <a href="{% url 'add_task_to_job' job.id %}" class="btn btn-sm btn-success ms-2">#}
{#                                    <i class="fas fa-plus"></i> Add Task#}
{#                                </a>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                    <div class="card-body">#}
{#                        <div class="row">#}
{#                            <div class="col-md-6">#}
{#                                <h5><i class="fas fa-user"></i> Client Information</h5>#}
{#                                <p><strong>Email:</strong> {{ job.client_email }}</p>#}
{#                                <p><strong>Created:</strong> {{ job.created_at|date:"F d, Y" }}</p>#}
{#                                {% if latest_deadline %}#}
{#                                <p><strong>Latest Deadline:</strong> {{ latest_deadline|date:"F d, Y" }}</p>#}
{#                                {% endif %}#}
{#                            </div>#}
{#                            <div class="col-md-6">#}
{#                                <h5><i class="fas fa-chart-line"></i> Job Progress</h5>#}
{#                                <div class="progress mb-2">#}
{#                                    <div class="progress-bar bg-success" role="progressbar" #}
{#                                         style="width: {{ overall_progress }}%;" #}
{#                                         aria-valuenow="{{ overall_progress }}" #}
{#                                         aria-valuemin="0" #}
{#                                         aria-valuemax="100">{{ overall_progress }}%</div>#}
{#                                </div>#}
{#                                <div class="row mt-3">#}
{#                                    <div class="col-md-6">#}
{#                                        <p><strong>Total Income:</strong> ${{ job.over_all_income }}</p>#}
{#                                    </div>#}
{#                                    <div class="col-md-6">#}
{#                                        <p><strong>Allocated to Tasks:</strong> ${{ total_task_payment }}</p>#}
{#                                        <p><strong>Remaining:</strong> ${{ remaining_income }}</p>#}
{#                                    </div>#}
{#                                </div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{##}
{#        <!-- Regular Tasks Section -->#}
{#        <div class="card mb-4">#}
{#            <div class="card-header bg-secondary text-white">#}
{#                <h5 class="mb-0">#}
{#                    <i class="fas fa-tasks mr-2"></i> Project Tasks#}
{#                </h5>#}
{#            </div>#}
{#            <div class="card-body">#}
{#                {% if regular_tasks %}#}
{#                <div class="table-responsive">#}
{#                    <table class="table table-hover">#}
{#                        <thead>#}
{#                            <tr>#}
{#                                <th>Title</th>#}
{#                                <th>Type</th>#}
{#                                <th>Assigned To</th>#}
{#                                <th>Deadline</th>#}
{#                                <th>Progress</th>#}
{#                                <th>Payment</th>#}
{#                                <th>Actions</th>#}
{#                            </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                            {% for task in regular_tasks %}#}
{#                            <tr class="{% if task.task_type == 'MONTHLY' %}monthly-task{% else %}simple-task{% endif %}">#}
{#                                <td>{{ task.title }}</td>#}
{#                                <td>#}
{#                                    {% if task.task_type == 'SIMPLE' %}#}
{#                                        <span class="badge bg-secondary">Simple</span>#}
{#                                    {% elif task.task_type == 'MONTHLY' %}#}
{#                                        <span class="badge bg-primary">Monthly</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    {% for user in task.assigned_users.all %}#}
{#                                    <span class="badge bg-info">{{ user.email }}</span>#}
{#                                    {% empty %}#}
{#                                    <span class="badge bg-warning">Not assigned</span>#}
{#                                    {% endfor %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    {% if task.deadline %}#}
{#                                    {{ task.deadline }}#}
{#                                    {% else %}#}
{#                                    <span class="text-muted">No deadline</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    <div class="progress">#}
{#                                        <div class="progress-bar {% if task.progress == 100 %}bg-success{% endif %}" #}
{#                                             role="progressbar" #}
{#                                             style="width: {{ task.progress }}%;" #}
{#                                             aria-valuenow="{{ task.progress }}" #}
{#                                             aria-valuemin="0" #}
{#                                             aria-valuemax="100">{{ task.progress }}%</div>#}
{#                                    </div>#}
{#                                </td>#}
{#                                <td>${{ task.money_for_task }}</td>#}
{#                                <td>#}
{#                                    <div class="btn-group">#}
{#                                        <form method="post" action="{% url 'change_task_status' task.id %}" class="d-inline">#}
{#                                            {% csrf_token %}#}
{#                                            <button type="submit" class="btn btn-sm btn-outline-primary">#}
{#                                                <i class="fas fa-sync-alt"></i> Change Type#}
{#                                            </button>#}
{#                                        </form>#}
{#                                        <form method="post" action="{% url 'delete_task' task.id %}" class="d-inline ms-2" #}
{#                                              onsubmit="return confirm('Are you sure you want to delete this task?');">#}
{#                                            {% csrf_token %}#}
{#                                            <button type="submit" class="btn btn-sm btn-outline-danger">#}
{#                                                <i class="fas fa-trash"></i> Delete#}
{#                                            </button>#}
{#                                        </form>#}
{#                                    </div>#}
{#                                </td>#}
{#                            </tr>#}
{#                            {% endfor %}#}
{#                        </tbody>#}
{#                    </table>#}
{#                </div>#}
{##}
{#                <!-- Pagination for Regular Tasks -->#}
{#                {% if regular_tasks.has_other_pages %}#}
{#                <nav aria-label="Task pagination">#}
{#                    <ul class="pagination justify-content-center">#}
{#                        {% if regular_tasks.has_previous %}#}
{#                        <li class="page-item">#}
{#                            <a class="page-link" href="?page={{ regular_tasks.previous_page_number }}">&laquo; Previous</a>#}
{#                        </li>#}
{#                        {% else %}#}
{#                        <li class="page-item disabled">#}
{#                            <span class="page-link">&laquo; Previous</span>#}
{#                        </li>#}
{#                        {% endif %}#}
{##}
{#                        {% for i in regular_tasks.paginator.page_range %}#}
{#                        <li class="page-item {% if regular_tasks.number == i %}active{% endif %}">#}
{#                            <a class="page-link" href="?page={{ i }}">{{ i }}</a>#}
{#                        </li>#}
{#                        {% endfor %}#}
{##}
{#                        {% if regular_tasks.has_next %}#}
{#                        <li class="page-item">#}
{#                            <a class="page-link" href="?page={{ regular_tasks.next_page_number }}">Next &raquo;</a>#}
{#                        </li>#}
{#                        {% else %}#}
{#                        <li class="page-item disabled">#}
{#                            <span class="page-link">Next &raquo;</span>#}
{#                        </li>#}
{#                        {% endif %}#}
{#                    </ul>#}
{#                </nav>#}
{#                {% endif %}#}
{##}
{#                {% else %}#}
{#                <p class="text-center">No tasks found for this job.</p>#}
{#                {% endif %}#}
{#            </div>#}
{#        </div>#}
{##}
{#        {% if show_follow_tasks %}#}
{#        <!-- Follow Tasks View Toggle -->#}
{#        <div class="btn-group w-100 mb-3" role="group" aria-label="Task view toggle">#}
{#            <button type="button" class="btn btn-outline-success view-toggle-btn active" id="list-view-btn">LIST VIEW</button>#}
{#            <button type="button" class="btn btn-outline-success view-toggle-btn" id="sheet-view-btn">SHEET VIEW</button>#}
{#        </div>#}
{##}
{#        <!-- Follow Tasks List View -->#}
{#        <div class="card mb-4" id="list-view">#}
{#            <div class="card-header bg-success text-white">#}
{#                <h5 class="mb-0">#}
{#                    <i class="fas fa-sync-alt mr-2"></i> Follow Tasks (Recurring Monthly Tasks)#}
{#                </h5>#}
{#            </div>#}
{#            <div class="card-body">#}
{#                {% if follow_tasks %}#}
{#                <div class="table-responsive">#}
{#                    <table class="table table-hover">#}
{#                        <thead>#}
{#                            <tr>#}
{#                                <th>Title</th>#}
{#                                <th>Month</th>#}
{#                                <th>Assigned To</th>#}
{#                                <th>Date</th>#}
{#                                <th>Progress</th>#}
{#                                <th>Payment</th>#}
{#                                <th>Actions</th>#}
{#                            </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                            {% for task in follow_tasks %}#}
{#                            <tr class="follow-task">#}
{#                                <td>{{ task.title }}</td>#}
{#                                <td>#}
{#                                    <span class="badge bg-success">Follow Task</span>#}
{#                                </td>#}
{#                                <td>#}
{#                                    {% for user in task.assigned_users.all %}#}
{#                                    <span class="badge bg-info">{{ user.email }}</span>#}
{#                                    {% empty %}#}
{#                                    <span class="badge bg-warning">Not assigned</span>#}
{#                                    {% endfor %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    {% if task.deadline %}#}
{#                                    {{ task.deadline }}#}
{#                                    {% else %}#}
{#                                    <span class="text-muted">No date</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    <div class="progress">#}
{#                                        <div class="progress-bar {% if task.progress == 100 %}bg-success{% endif %}" #}
{#                                             role="progressbar" #}
{#                                             style="width: {{ task.progress }}%;" #}
{#                                             aria-valuenow="{{ task.progress }}" #}
{#                                             aria-valuemin="0" #}
{#                                             aria-valuemax="100">{{ task.progress }}%</div>#}
{#                                    </div>#}
{#                                </td>#}
{#                                <td>${{ task.money_for_task }}</td>#}
{#                                <td>#}
{#                                    <form method="post" action="{% url 'delete_task' task.id %}" class="d-inline" #}
{#                                          onsubmit="return confirm('Are you sure you want to delete this follow task?');">#}
{#                                        {% csrf_token %}#}
{#                                        <button type="submit" class="btn btn-sm btn-outline-danger">#}
{#                                            <i class="fas fa-trash"></i> Delete#}
{#                                        </button>#}
{#                                    </form>#}
{#                                </td>#}
{#                            </tr>#}
{#                            {% endfor %}#}
{#                        </tbody>#}
{#                    </table>#}
{#                </div>#}
{##}
{#                <!-- Pagination for Follow Tasks -->#}
{#                {% if follow_tasks.has_other_pages %}#}
{#                <nav aria-label="Follow Tasks pagination">#}
{#                    <ul class="pagination justify-content-center">#}
{#                        {% if follow_tasks.has_previous %}#}
{#                        <li class="page-item">#}
{#                            <a class="page-link" href="?follow_page={{ follow_tasks.previous_page_number }}">&laquo; Previous</a>#}
{#                        </li>#}
{#                        {% else %}#}
{#                        <li class="page-item disabled">#}
{#                            <span class="page-link">&laquo; Previous</span>#}
{#                        </li>#}
{#                        {% endif %}#}
{##}
{#                        {% for i in follow_tasks.paginator.page_range %}#}
{#                        <li class="page-item {% if follow_tasks.number == i %}active{% endif %}">#}
{#                            <a class="page-link" href="?follow_page={{ i }}">{{ i }}</a>#}
{#                        </li>#}
{#                        {% endfor %}#}
{##}
{#                        {% if follow_tasks.has_next %}#}
{#                        <li class="page-item">#}
{#                            <a class="page-link" href="?follow_page={{ follow_tasks.next_page_number }}">Next &raquo;</a>#}
{#                        </li>#}
{#                        {% else %}#}
{#                        <li class="page-item disabled">#}
{#                            <span class="page-link">Next &raquo;</span>#}
{#                        </li>#}
{#                        {% endif %}#}
{#                    </ul>#}
{#                </nav>#}
{#                {% endif %}#}
{##}
{#                {% else %}#}
{#                <p class="text-center">No follow tasks found for this job.</p>#}
{#                {% endif %}#}
{#            </div>#}
{#        </div>#}
{##}
{#      <!-- Follow Tasks Sheet View -->#}
{#<div class="card mb-4" id="sheet-view" style="display: none;">#}
{#    <div class="card-header bg-success text-white">#}
{#        <h5 class="mb-0">#}
{#            <i class="fas fa-table mr-2"></i> Follow Tasks Sheet View#}
{#        </h5>#}
{#    </div>#}
{#    <div class="card-body">#}
{#        {% if all_months %}#}
{#            <div class="table-responsive">#}
{#                <table class="table table-bordered">#}
{#                    <thead>#}
{#                        <tr>#}
{#                            <th class="bg-light" style="min-width: 200px;">Task Name</th>#}
{#                            {% for month in all_months %}#}
{#                                <th class="text-center">{{ month }}</th>#}
{#                            {% endfor %}#}
{#                        </tr>#}
{#                    </thead>#}
{#                    <tbody>#}
{#                        {% for row in task_matrix %}#}
{#                            <tr>#}
{#                                <th class="bg-light">{{ row.base_name }}</th>#}
{#                                {% for cell in row.cells %}#}
{#                                    {% if not cell.empty %}#}
{#                                        <td class="text-center {% if cell.task.progress <= 0 %}progress-cell-0{% elif cell.task.progress <= 25 %}progress-cell-25{% elif cell.task.progress <= 50 %}progress-cell-50{% elif cell.task.progress <= 75 %}progress-cell-75{% else %}progress-cell-100{% endif %}">#}
{#                                            <div class="d-flex flex-column align-items-center">#}
{#                                                <strong>{{ cell.task.progress }}%</strong>#}
{#                                                <small>${{ cell.task.money_for_task }}</small>#}
{#                                                <div class="mt-1">#}
{#                                                    <form method="post" action="{% url 'delete_task' cell.task.id %}" class="d-inline" #}
{#                                                        onsubmit="return confirm('Are you sure you want to delete this follow task?');">#}
{#                                                        {% csrf_token %}#}
{#                                                        <button type="submit" class="btn btn-sm btn-outline-danger" style="padding: 0.1rem 0.3rem; font-size: 0.7rem;">#}
{#                                                            <i class="fas fa-trash"></i>#}
{#                                                        </button>#}
{#                                                    </form>#}
{#                                                </div>#}
{#                                            </div>#}
{#                                        </td>#}
{#                                    {% else %}#}
{#                                        <td class="text-center bg-light">-</td>#}
{#                                    {% endif %}#}
{#                                {% endfor %}#}
{#                            </tr>#}
{#                        {% endfor %}#}
{#                    </tbody>#}
{#                </table>#}
{#            </div>#}
{##}
{#            <div class="mt-3">#}
{#                <p><strong>Note:</strong> This sheet view shows the progress of recurring tasks across months. Empty cells indicate months where the task is not scheduled. The intensity of the green color indicates the level of progress.</p>#}
{#            </div>#}
{#        {% else %}#}
{#            <p class="text-center">No follow tasks found for this job.</p>#}
{#        {% endif %}#}
{#    </div>#}
{#</div>#}
{#        {% endif %}#}
{##}
{#        <!-- Danger Zone -->#}
{#        <div class="card border-danger">#}
{#            <div class="card-header bg-danger text-white">#}
{#                <h5 class="mb-0">Danger Zone</h5>#}
{#            </div>#}
{#            <div class="card-body">#}
{#                <p>Be careful - these actions cannot be undone!</p>#}
{#                <form method="post" action="{% url 'delete_job' job.id %}" #}
{#                      onsubmit="return confirm('Are you sure you want to delete this entire job? This will delete all tasks and cannot be undone.');">#}
{#                    {% csrf_token %}#}
{#                    <button type="submit" class="btn btn-danger">#}
{#                        <i class="fas fa-trash"></i> Delete Entire Job#}
{#                    </button>#}
{#                </form>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Bootstrap JS -->#}
{#    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>#}
{##}
{#    <!-- Toggle view script -->#}
{#    <script>#}
{#        document.addEventListener('DOMContentLoaded', function() {#}
{#            const listViewBtn = document.getElementById('list-view-btn');#}
{#            const sheetViewBtn = document.getElementById('sheet-view-btn');#}
{#            const listView = document.getElementById('list-view');#}
{#            const sheetView = document.getElementById('sheet-view');#}
{##}
{#            if (listViewBtn && sheetViewBtn) {#}
{#                listViewBtn.addEventListener('click', function() {#}
{#                    listView.style.display = 'block';#}
{#                    sheetView.style.display = 'none';#}
{#                    listViewBtn.classList.add('active');#}
{#                    sheetViewBtn.classList.remove('active');#}
{#                });#}
{##}
{#                sheetViewBtn.addEventListener('click', function() {#}
{#                    listView.style.display = 'none';#}
{#                    sheetView.style.display = 'block';#}
{#                    sheetViewBtn.classList.add('active');#}
{#                    listViewBtn.classList.remove('active');#}
{#                });#}
{#            }#}
{#        });#}
{#    </script>#}
{#</body>#}
{#</html>#}
{##}
{##}



<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>Добавить задачи в проект: {{ job.title }}</title>
    <!-- Подключение шрифтов Google -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,500,700&display=swap" rel="stylesheet" />
    <!-- Мета-тег для адаптивности -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Внутренние CSS-стили -->
    <style>
      /* Сброс CSS */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      body {
        font-family: 'Roboto', sans-serif;
        background-color: #f7f9fc;
        color: #333;
        line-height: 1.6;
      }

      .container {
        max-width: 800px;
        margin: 40px auto;
        background-color: #fff;
        padding: 30px 40px;
        box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        border-radius: 8px;
      }

      h2 {
        text-align: center;
        margin-bottom: 30px;
        color: #2c3e50;
      }

      form {
        width: 100%;
      }

      .task-form {
        border: 1px solid #e0e4e8;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 6px;
        background-color: #fafbfd;
      }

      .task-form h3 {
        margin-bottom: 15px;
        color: #34495e;
      }

      .field-wrapper {
        margin-bottom: 15px;
      }

      .field-wrapper label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
        color: #555;
      }

      .field-wrapper input[type='text'],
      .field-wrapper input[type='number'],
      .field-wrapper input[type='date'],
      .field-wrapper select,
      .field-wrapper textarea {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #ccd1d7;
        border-radius: 4px;
        font-size: 15px;
        color: #333;
        background-color: #fff;
        transition: border-color 0.3s ease;
      }

      .field-wrapper input:focus,
      .field-wrapper select:focus,
      .field-wrapper textarea:focus {
        border-color: #3498db;
        outline: none;
      }

      .date-range-wrapper {
        display: none;
        margin-top: 15px;
        padding: 15px;
        background-color: #f8f9fa;
        border-radius: 4px;
        border-left: 4px solid #27ae60;
      }

      .date-range-title {
        font-weight: 600;
        margin-bottom: 10px;
        color: #27ae60;
      }

      .date-fields {
        display: flex;
        gap: 15px;
      }

      .date-field {
        flex: 1;
      }

      .task-type-badges {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
      }

      .task-badge {
        padding: 5px 10px;
        border-radius: 4px;
        font-size: 12px;
        font-weight: 500;
      }

      .badge-simple {
        background-color: #e0e4e8;
        color: #555;
      }

      .badge-monthly {
        background-color: #3498db;
        color: white;
      }

      .badge-patpis {
        background-color: #27ae60;
        color: white;
      }

      .errorlist {
        color: #e74c3c;
        margin-top: 5px;
        font-size: 14px;
      }

      .errorlist p {
        margin: 0;
      }

      .form-actions {
        text-align: center;
        margin-top: 30px;
      }

      .form-actions button {
        background-color: #3498db;
        color: #fff;
        padding: 12px 30px;
        border: none;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .form-actions button:hover {
        background-color: #2980b9;
      }

      .alert {
        padding: 10px 15px;
        margin-bottom: 20px;
        border-radius: 4px;
      }

      .alert-info {
        background-color: #d1ecf1;
        color: #0c5460;
        border: 1px solid #bee5eb;
      }

      .patpis-notice {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
        padding: 8px 12px;
        margin-top: 5px;
        border-radius: 4px;
      }

      /* Адаптивный дизайн */
      @media (max-width: 600px) {
        .container {
          padding: 20px;
        }

        .task-form {
          padding: 15px;
        }

        .form-actions button {
          width: 100%;
        }

        .date-fields {
          flex-direction: column;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Добавить задачи в проект: {{ job.title }}</h2>

      <div class="alert alert-info">
        <p><strong>Типы задач:</strong></p>
        <ul>
          <li><strong>Simple</strong> - обычная задача</li>
          <li><strong>Monthly</strong> - ежемесячная задача</li>
          <li><strong>Follow Task</strong> - повторяющаяся задача (автоматически создаст задачи на каждый месяц в указанном диапазоне дат)</li>
        </ul>
      </div>

      <form method="post">
        {% csrf_token %}
        {{ task_formset.management_form }}

        {% if task_formset.non_form_errors %}
          <div class="errorlist">
            {% for error in task_formset.non_form_errors %}
              <p class="error">{{ error }}</p>
            {% endfor %}
          </div>
        {% endif %}

        {% for form in task_formset %}
          <div class="task-form" id="task-form-{{ forloop.counter }}">
            <h3>Задача {{ forloop.counter }}</h3>
            {{ form.non_field_errors }}

            <!-- Task Type Field -->
            <div class="field-wrapper">
              <label for="{{ form.task_type.id_for_label }}">Тип задачи</label>
              {{ form.task_type }}
              {% if form.task_type.errors %}
                <div class="errorlist">
                  {% for error in form.task_type.errors %}
                    <p class="error">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
              <small style="color: #888;">Выберите тип задачи. Follow Task создаст повторяющиеся задачи на каждый месяц в указанном диапазоне.</small>
            </div>

            <!-- Title Field -->
            <div class="field-wrapper">
              <label for="{{ form.title.id_for_label }}">{{ form.title.label }}</label>
              {{ form.title }}
              {% if form.title.errors %}
                <div class="errorlist">
                  {% for error in form.title.errors %}
                    <p class="error">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Description Field -->
            <div class="field-wrapper">
              <label for="{{ form.description.id_for_label }}">{{ form.description.label }}</label>
              {{ form.description }}
              {% if form.description.errors %}
                <div class="errorlist">
                  {% for error in form.description.errors %}
                    <p class="error">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Hours Field -->
            <div class="field-wrapper">
              <label for="{{ form.hours.id_for_label }}">{{ form.hours.label }}</label>
              {{ form.hours }}
              {% if form.hours.errors %}
                <div class="errorlist">
                  {% for error in form.hours.errors %}
                    <p class="error">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Date Field(s) -->
            <!-- For regular tasks, show deadline -->
            <div class="field-wrapper deadline-wrapper">
              <label for="{{ form.deadline.id_for_label }}">{{ form.deadline.label }}</label>
              {{ form.deadline }}
              {% if form.deadline.errors %}
                <div class="errorlist">
                  {% for error in form.deadline.errors %}
                    <p class="error">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- For Follow Tasks, show date range (outside the form) -->
            <div class="date-range-wrapper">
              <div class="date-range-title">Диапазон дат для повторяющихся задач</div>
              <div class="date-fields">
                <div class="date-field">
                  <label for="range_start_date-{{ forloop.counter }}">Дата начала</label>
                  <input type="date" name="range_start_date" id="range_start_date-{{ forloop.counter }}" class="form-control range-start-date">
                </div>
                <div class="date-field">
                  <label for="range_end_date-{{ forloop.counter }}">Дата окончания</label>
                  <input type="date" name="range_end_date" id="range_end_date-{{ forloop.counter }}" class="form-control range-end-date">
                </div>
              </div>
              <small style="color: #555; margin-top: 10px; display: block;">
                Будут созданы задачи на каждый месяц между указанными датами, включая их.
              </small>
            </div>

            <!-- Assigned Users Field -->
            <div class="field-wrapper">
              <label for="{{ form.assigned_users.id_for_label }}">{{ form.assigned_users.label }}</label>
              {{ form.assigned_users }}
              {% if form.assigned_users.errors %}
                <div class="errorlist">
                  {% for error in form.assigned_users.errors %}
                    <p class="error">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <!-- Money for Task Field -->
            <div class="field-wrapper">
              <label for="{{ form.money_for_task.id_for_label }}">{{ form.money_for_task.label }}</label>
              {{ form.money_for_task }}
              {% if form.money_for_task.errors %}
                <div class="errorlist">
                  {% for error in form.money_for_task.errors %}
                    <p class="error">{{ error }}</p>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            {% for hidden in form.hidden_fields %}
              {{ hidden }}
            {% endfor %}
          </div>
        {% endfor %}

        <div class="form-actions">
          <button type="submit">Сохранить задачи</button>
        </div>
      </form>
    </div>

    <script>
      document.addEventListener('DOMContentLoaded', function() {
        // Set default end date to 1 year from today
        const today = new Date();
        const nextYear = new Date(today);
        nextYear.setFullYear(today.getFullYear() + 1);

        const formatDate = (date) => {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        };

        // Set default dates for range fields
        document.querySelectorAll('.range-start-date').forEach(field => {
            field.value = formatDate(today);
        });

        document.querySelectorAll('.range-end-date').forEach(field => {
            field.value = formatDate(nextYear);
        });

        // Function to handle task type selection
        const taskTypeSelects = document.querySelectorAll('.task-type-select');

        // Function to toggle field visibility based on task type
        function toggleFieldsVisibility(taskForm, taskType) {
          const deadlineWrapper = taskForm.querySelector('.deadline-wrapper');
          const dateRangeWrapper = taskForm.querySelector('.date-range-wrapper');

          if (taskType === 'PATPIS') {
            // For Follow Tasks, show date range, hide deadline
            if (deadlineWrapper) deadlineWrapper.style.display = 'none';
            if (dateRangeWrapper) dateRangeWrapper.style.display = 'block';

            // Add a notice about recurring tasks if it doesn't exist
            if (!taskForm.querySelector('.patpis-notice')) {
              const notice = document.createElement('div');
              notice.className = 'patpis-notice';
              notice.innerHTML = '<strong>Follow Task:</strong> Будут созданы задачи на каждый месяц между указанными датами. Каждая задача будет на то же число месяца, что и начальная дата.';
              dateRangeWrapper.appendChild(notice);
            }

            // Change task form styling
            taskForm.style.borderColor = '#27ae60';
            taskForm.style.borderLeftWidth = '5px';
          } else {
            // For other task types, hide date range, show deadline
            if (deadlineWrapper) deadlineWrapper.style.display = 'block';
            if (dateRangeWrapper) dateRangeWrapper.style.display = 'none';

            // Remove the notice if exists
            const notice = taskForm.querySelector('.patpis-notice');
            if (notice) {
              notice.remove();
            }

            // Change task form styling based on task type
            if (taskType === 'MONTHLY') {
              taskForm.style.borderColor = '#3498db';
              taskForm.style.borderLeftWidth = '5px';
            } else {
              taskForm.style.borderColor = '#e0e4e8';
              taskForm.style.borderLeftWidth = '1px';
            }
          }
        }

        // Initialize all task forms
        taskTypeSelects.forEach(select => {
          const taskForm = select.closest('.task-form');
          toggleFieldsVisibility(taskForm, select.value);

          // Add change event listener
          select.addEventListener('change', function() {
            toggleFieldsVisibility(taskForm, this.value);
          });
        });
      });
    </script>
  </body>
</html>













{##}
{##}
{#{% load static %}#}
{#<!DOCTYPE html>#}
{#<html lang="en">#}
{#<head>#}
{#    <meta charset="UTF-8">#}
{#    <meta name="viewport" content="width=device-width, initial-scale=1.0">#}
{#    <title>{{ job.title }} - Project Details</title>#}
{#    <!-- Bootstrap CSS -->#}
{#    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">#}
{#    <!-- Font Awesome -->#}
{#    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">#}
{#    <!-- Google Fonts -->#}
{#    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">#}
{#    <style>#}
{#        :root {#}
{#            --primary-blue: #4361ee;#}
{#            --light-gray: #f8f9fc;#}
{#            --dark-text: #333;#}
{#            --medium-gray: #6c757d;#}
{#            --success-green: #2ecc71;#}
{#            --danger-red: #e74c3c;#}
{#            --border-color: #e0e0e0;#}
{#            --light-border: #efefef;#}
{#            --highlight-yellow: #ffc107; /* Bright yellow for highlight */#}
{#            --highlight-border: #ff9800; /* Orange border */#}
{#        }#}
{#        #}
{#        body {#}
{#            font-family: 'Inter', sans-serif;#}
{#            background-color: var(--light-gray);#}
{#            color: var(--dark-text);#}
{#            line-height: 1.6;#}
{#        }#}
{#        #}
{#        .container-fluid {#}
{#            padding: 0;#}
{#        }#}
{#        #}
{#        .main-content {#}
{#            padding: 25px;#}
{#            max-width: 1200px;#}
{#            margin: 0 auto;#}
{#        }#}
{#        #}
{#        /* Sidebar styles */#}
{#        .sidebar {#}
{#            background-color: #2c3e50;#}
{#            color: white;#}
{#            min-height: 100vh;#}
{#            width: 240px;#}
{#            position: fixed;#}
{#            left: 0;#}
{#            top: 0;#}
{#            padding: 20px 0;#}
{#        }#}
{#        #}
{#        .sidebar-title {#}
{#            padding: 0 20px 20px;#}
{#            border-bottom: 1px solid rgba(255, 255, 255, 0.1);#}
{#            margin-bottom: 20px;#}
{#        }#}
{#        #}
{#        .sidebar-menu {#}
{#            list-style: none;#}
{#            padding: 0;#}
{#            margin: 0;#}
{#        }#}
{#        #}
{#        .sidebar-menu li {#}
{#            padding: 10px 20px;#}
{#            display: flex;#}
{#            align-items: center;#}
{#        }#}
{#        #}
{#        .sidebar-menu li i {#}
{#            margin-right: 10px;#}
{#            width: 20px;#}
{#            text-align: center;#}
{#        }#}
{#        #}
{#        .sidebar-menu li.active {#}
{#            background-color: rgba(255, 255, 255, 0.1);#}
{#        }#}
{#        #}
{#        .content-wrapper {#}
{#            margin-left: 240px;#}
{#            min-height: 100vh;#}
{#        }#}
{#        #}
{#        /* Project Header (ENLARGED) */#}
{#        .project-header {#}
{#            background-color: white;#}
{#            padding: 30px;#}
{#            border-radius: 10px;#}
{#            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);#}
{#            margin-bottom: 25px;#}
{#        }#}
{#        #}
{#        .project-title-section {#}
{#            display: flex;#}
{#            justify-content: space-between;#}
{#            align-items: center;#}
{#            margin-bottom: 25px;#}
{#        }#}
{#        #}
{#        .project-title {#}
{#            font-weight: 600;#}
{#            font-size: 28px;#}
{#            margin-bottom: 5px;#}
{#        }#}
{#        #}
{#        .project-email {#}
{#            color: var(--medium-gray);#}
{#            font-size: 16px;#}
{#        }#}
{#        #}
{#        /* Stats cards (ENLARGED) */#}
{#        .stats-row {#}
{#            display: flex;#}
{#            gap: 20px;#}
{#            margin-bottom: 30px;#}
{#        }#}
{#        #}
{#        .stat-card {#}
{#            background-color: white;#}
{#            border-radius: 10px;#}
{#            padding: 25px;#}
{#            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);#}
{#            flex: 1;#}
{#            display: flex;#}
{#            align-items: center;#}
{#        }#}
{#        #}
{#        .stat-icon {#}
{#            width: 50px;#}
{#            height: 50px;#}
{#            margin-right: 20px;#}
{#            display: flex;#}
{#            align-items: center;#}
{#            justify-content: center;#}
{#            border-radius: 8px;#}
{#            font-size: 24px;#}
{#        }#}
{#        #}
{#        .blue-icon {#}
{#            background-color: rgba(67, 97, 238, 0.1);#}
{#            color: var(--primary-blue);#}
{#        }#}
{#        #}
{#        .green-icon {#}
{#            background-color: rgba(46, 204, 113, 0.1);#}
{#            color: var(--success-green);#}
{#        }#}
{#        #}
{#        .orange-icon {#}
{#            background-color: rgba(243, 156, 18, 0.1);#}
{#            color: #f39c12;#}
{#        }#}
{#        #}
{#        .aqua-icon {#}
{#            background-color: rgba(52, 152, 219, 0.1);#}
{#            color: #3498db;#}
{#        }#}
{#        #}
{#        .stat-value {#}
{#            font-size: 30px;#}
{#            font-weight: 600;#}
{#            margin-bottom: 5px;#}
{#        }#}
{#        #}
{#        .stat-label {#}
{#            color: var(--medium-gray);#}
{#            font-size: 16px;#}
{#        }#}
{#        #}
{#        /* Button styles */#}
{#        .btn {#}
{#            padding: 10px 18px;#}
{#            border-radius: 6px;#}
{#            font-weight: 500;#}
{#            font-size: 16px;#}
{#        }#}
{#        #}
{#        .btn-add {#}
{#            background-color: #4e73df;#}
{#            color: white;#}
{#            border: none;#}
{#        }#}
{#        #}
{#        .btn-add:hover {#}
{#            background-color: #375ad3;#}
{#            color: white;#}
{#        }#}
{#        #}
{#        .btn-delete {#}
{#            background-color: #e74a3b;#}
{#            color: white;#}
{#            border: none;#}
{#        }#}
{#        #}
{#        .btn-delete:hover {#}
{#            background-color: #d13426;#}
{#            color: white;#}
{#        }#}
{#        #}
{#        /* Table styles */#}
{#        .table-card {#}
{#            background-color: white;#}
{#            border-radius: 8px;#}
{#            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);#}
{#            overflow: hidden;#}
{#            margin-bottom: 30px;#}
{#        }#}
{#        #}
{#        .table {#}
{#            margin-bottom: 0;#}
{#        }#}
{#        #}
{#        .table th {#}
{#            font-weight: 600;#}
{#            background-color: #f8f9fa;#}
{#            border-top: none;#}
{#            border-bottom: 1px solid var(--light-border);#}
{#            padding: 15px 16px;#}
{#            color: var(--medium-gray);#}
{#            font-size: 14px;#}
{#        }#}
{#        #}
{#        .table td {#}
{#            padding: 15px 16px;#}
{#            vertical-align: middle;#}
{#            border-color: var(--light-border);#}
{#            font-size: 14px;#}
{#        }#}
{#        #}
{#        .table tr:hover {#}
{#            background-color: #f9f9f9;#}
{#        }#}
{#        #}
{#        /* Progress bar styles */#}
{#        .progress {#}
{#            height: 8px;#}
{#            background-color: #f0f0f0;#}
{#            border-radius: 4px;#}
{#        }#}
{#        #}
{#        .progress-bar {#}
{#            background-color: var(--primary-blue);#}
{#            border-radius: 4px;#}
{#        }#}
{#        #}
{#        .progress-complete .progress-bar {#}
{#            background-color: var(--success-green);#}
{#        }#}
{#        #}
{#        /* Badge styles */#}
{#        .badge {#}
{#            padding: 6px 10px;#}
{#            font-weight: 500;#}
{#            font-size: 12px;#}
{#            border-radius: 4px;#}
{#        }#}
{#        #}
{#        .badge-simple {#}
{#            background-color: #e9ecef;#}
{#            color: #495057;#}
{#        }#}
{#        #}
{#        .badge-patpis {#}
{#            background-color: #e3f2fd;#}
{#            color: #0d6efd;#}
{#        }#}
{#        #}
{#        /* View toggle styles */#}
{#        .view-toggle {#}
{#            display: flex;#}
{#            justify-content: center;#}
{#            margin-bottom: 20px;#}
{#        }#}
{#        #}
{#        .toggle-btn {#}
{#            background-color: white;#}
{#            border: 1px solid #ddd;#}
{#            padding: 8px 16px;#}
{#            font-size: 14px;#}
{#            font-weight: 500;#}
{#            cursor: pointer;#}
{#        }#}
{#        #}
{#        .toggle-btn:first-child {#}
{#            border-top-left-radius: 6px;#}
{#            border-bottom-left-radius: 6px;#}
{#        }#}
{#        #}
{#        .toggle-btn:last-child {#}
{#            border-top-right-radius: 6px;#}
{#            border-bottom-right-radius: 6px;#}
{#        }#}
{#        #}
{#        .toggle-btn.active {#}
{#            background-color: var(--primary-blue);#}
{#            color: white;#}
{#            border-color: var(--primary-blue);#}
{#        }#}
{#        #}
{#        /* Action button styles */#}
{#        .action-btn {#}
{#            color: var(--medium-gray);#}
{#            background: none;#}
{#            border: none;#}
{#            cursor: pointer;#}
{#            padding: 5px;#}
{#            transition: color 0.2s;#}
{#        }#}
{#        #}
{#        .action-btn:hover {#}
{#            color: var(--danger-red);#}
{#        }#}
{#        #}
{#        /* Checkbox custom styles */#}
{#        .task-checkbox {#}
{#            margin-right: 5px;#}
{#        }#}
{##}
{#        #}
{#        #}
{#        #}
{#        #}
{#        #}
{#        #}
{#        #}
{#       /* Sheet View Styles - medium size */#}
{#.sheet-view-container {#}
{#    background-color: white;#}
{#    border-radius: 6px;#}
{#    box-shadow: 0 1px 2px rgba(0,0,0,0.1);#}
{#    overflow: hidden;#}
{#    margin-bottom: 30px;#}
{#}#}
{##}
{#.sheet-table {#}
{#    width: 100%;#}
{#    border-collapse: collapse;#}
{#}#}
{##}
{#.sheet-table th, #}
{#.sheet-table td {#}
{#    border: 1px solid #dee2e6;#}
{#    padding: 16px 14px; /* Medium increased padding */#}
{#    text-align: center;#}
{#    position: relative;#}
{#    min-width: 130px; /* Wider minimum width */#}
{#}#}
{##}
{#.sheet-table th:first-child,#}
{#.sheet-table td:first-child {#}
{#    min-width: 200px; /* Wider first column */#}
{#    text-align: left;#}
{#    padding-left: 18px;#}
{#}#}
{##}
{#.sheet-table th {#}
{#    background-color: #f8f9fa;#}
{#    font-weight: 600;#}
{#    color: #495057;#}
{#    position: sticky;#}
{#    top: 0;#}
{#    z-index: 1;#}
{#}#}
{##}
{#/* Current month highlight for header */#}
{#.sheet-table th.current-month {#}
{#    background-color: var(--highlight-yellow) !important;#}
{#    color: #000 !important;#}
{#    font-weight: 700 !important;#}
{#    border: 2px solid var(--highlight-border) !important;#}
{#}#}
{##}
{#.sheet-table td:first-child {#}
{#    text-align: left;#}
{#    font-weight: 500;#}
{#    padding-left: 18px;#}
{#    background-color: #f8f9fa;#}
{#    position: sticky;#}
{#    left: 0;#}
{#    z-index: 2;#}
{#}#}
{##}
{#/* Current month highlight for cells */#}
{#.sheet-table td.current-month-cell {#}
{#    background-color: rgba(255, 193, 7, 0.2) !important;#}
{#    border: 2px solid var(--highlight-border) !important;#}
{#}#}
{##}
{#/* Task cell styles */#}
{#.progress-cell {#}
{#    cursor: pointer;#}
{#    transition: background-color 0.2s ease;#}
{#    position: relative;#}
{#    height: 70px; /* Add some height */#}
{#}#}
{##}
{#.progress-cell:hover {#}
{#    background-color: #f8f9fa;#}
{#}#}
{##}
{#.progress-text {#}
{#    font-weight: 600;#}
{#    font-size: 18px; /* Medium larger text */#}
{#}#}
{##}
{#/* Colored progress cells */#}
{#.progress-cell-0 { background-color: #f7fafc; }#}
{#.progress-cell-25 { background-color: #e6f7ff; }#}
{#.progress-cell-50 { background-color: #d0f0fd; }#}
{#.progress-cell-75 { background-color: #bae7ff; }#}
{#.progress-cell-100 { background-color: #e6ffed; }#}
{##}
{#/* Task count badge */#}
{#.task-count-badge {#}
{#    background-color: #007bff;#}
{#    color: white;#}
{#    padding: 4px 10px;#}
{#    border-radius: 12px;#}
{#    font-size: 13px;#}
{#    font-weight: bold;#}
{#}#}
{##}
{#/* Task details popup */#}
{#.task-details-popup {#}
{#    display: none;#}
{#    position: absolute;#}
{#    top: calc(100% + 5px);#}
{#    left: 0;#}
{#    background: white;#}
{#    border: 1px solid #dee2e6;#}
{#    border-radius: 4px;#}
{#    padding: 14px;#}
{#    box-shadow: 0 2px 8px rgba(0,0,0,0.15);#}
{#    z-index: 100;#}
{#    min-width: 240px; /* Medium wider popup */#}
{#    text-align: left;#}
{#}#}
{##}
{#.detail-header {#}
{#    display: flex;#}
{#    justify-content: space-between;#}
{#    align-items: center;#}
{#    border-bottom: 1px solid #eee;#}
{#    padding-bottom: 10px;#}
{#    margin-bottom: 10px;#}
{#}#}
{##}
{#.detail-row {#}
{#    display: flex;#}
{#    justify-content: space-between;#}
{#    margin-bottom: 8px;#}
{#}#}
{##}
{#.detail-label {#}
{#    color: #666;#}
{#    font-size: 13px;#}
{#}#}
{##}
{#.detail-value {#}
{#    font-weight: 500;#}
{#    font-size: 14px;#}
{#}#}
{##}
{#/* Multi-task list */#}
{#.multi-task-list {#}
{#    max-height: 230px;#}
{#    overflow-y: auto;#}
{#}#}
{##}
{#.multi-task-item {#}
{#    border-bottom: 1px solid #eee;#}
{#    padding: 10px 0;#}
{#}#}
{##}
{#.multi-task-item:last-child {#}
{#    border-bottom: none;#}
{#}#}
{#        #}
{#        #}
{#        #}
{#        #}
{#        #}
{#        #}
{#        #}
{#        #}
{#    </style>#}
{#</head>#}
{#<body>#}
{#    <div class="container-fluid">#}
{#        <!-- Sidebar (optional) -->#}
{#        <aside class="sidebar d-none d-md-block">#}
{#            <div class="sidebar-title">#}
{#                <h4>Детали проекта</h4>#}
{#            </div>#}
{#            <ul class="sidebar-menu">#}
{#                <li class="active"><i class="fas fa-home"></i> Главная</li>#}
{#                <li><i class="fas fa-project-diagram"></i> Проекты</li>#}
{#            </ul>#}
{#        </aside>#}
{#        #}
{#        <!-- Main Content -->#}
{#        <div class="content-wrapper">#}
{#            <div class="main-content">#}
{#                <!-- Project Header (ENLARGED) -->#}
{#                <div class="project-header">#}
{#                    <div class="project-title-section">#}
{#                        <div>#}
{#                            <h2 class="project-title">{{ job.title }}</h2>#}
{#                            <div class="project-email">{{ job.client_email }}</div>#}
{#                        </div>#}
{#                        <div>#}
{#                            <a href="{% url 'add_task_to_job' job.id %}" class="btn btn-add">#}
{#                                <i class="fas fa-plus me-2"></i> Добавить задачу#}
{#                            </a>#}
{#                            <button class="btn btn-delete ms-2">#}
{#                                <i class="fas fa-trash me-2"></i> Удалить проект#}
{#                            </button>#}
{#                        </div>#}
{#                    </div>#}
{#                    #}
{#                    <!-- Stats Cards (ENLARGED) -->#}
{#                    <div class="stats-row">#}
{#                        <div class="stat-card">#}
{#                            <div class="stat-icon blue-icon">#}
{#                                <i class="fas fa-file-invoice-dollar"></i>#}
{#                            </div>#}
{#                            <div>#}
{#                                <div class="stat-value">${{ job.over_all_income }}</div>#}
{#                                <div class="stat-label">Общий доход</div>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="stat-card">#}
{#                            <div class="stat-icon green-icon">#}
{#                                <i class="fas fa-wallet"></i>#}
{#                            </div>#}
{#                            <div>#}
{#                                <div class="stat-value">${{ remaining_income }}</div>#}
{#                                <div class="stat-label">Остаток</div>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="stat-card">#}
{#                            <div class="stat-icon orange-icon">#}
{#                                <i class="fas fa-chart-line"></i>#}
{#                            </div>#}
{#                            <div>#}
{#                                <div class="stat-value">{{ overall_progress }}%</div>#}
{#                                <div class="stat-label">Общий прогресс</div>#}
{#                            </div>#}
{#                        </div>#}
{#                        <div class="stat-card">#}
{#                            <div class="stat-icon aqua-icon">#}
{#                                <i class="fas fa-calendar-alt"></i>#}
{#                            </div>#}
{#                            <div>#}
{#                                <div class="stat-value">{{ latest_deadline|date:"d.m.Y" }}</div>#}
{#                                <div class="stat-label">Дедлайн</div>#}
{#                            </div>#}
{#                        </div>#}
{#                    </div>#}
{#                </div>#}
{#                #}
{#                <!-- View Toggle Buttons (Added for Sheet View) -->#}
{#                {% if show_follow_tasks %}#}
{#                <div class="view-toggle">#}
{#                    <button type="button" class="toggle-btn active" id="list-view-btn">Список</button>#}
{#                    <button type="button" class="toggle-btn" id="sheet-view-btn">Таблица</button>#}
{#                </div>#}
{#                {% endif %}#}
{#                #}
{#                <!-- List View -->#}
{#                <div class="table-card" id="list-view">#}
{#                    <table class="table">#}
{#                        <thead>#}
{#                            <tr>#}
{#                                <th style="width: 30%">Задача</th>#}
{#                                <th style="width: 15%">Разработчик</th>#}
{#                                <th style="width: 15%">Прогресс</th>#}
{#                                <th style="width: 10%">Оплата</th>#}
{#                                <th style="width: 15%">Сроки</th>#}
{#                                <th style="width: 8%">Статус</th>#}
{#                                <th style="width: 7%">Действия</th>#}
{#                            </tr>#}
{#                        </thead>#}
{#                        <tbody>#}
{#                            {% for task in regular_tasks %}#}
{#                            <tr>#}
{#                                <td>#}
{#                                    <div class="d-flex align-items-center">#}
{#                                        <input type="checkbox" class="task-checkbox" {% if task.progress == 100 %}checked{% endif %}>#}
{#                                        {{ task.title }}#}
{#                                    </div>#}
{#                                </td>#}
{#                                <td>#}
{#                                    {% for user in task.assigned_users.all %}#}
{#                                    <div class="small">{{ user.email }}</div>#}
{#                                    {% empty %}#}
{#                                    <span class="text-muted small">Не назначено</span>#}
{#                                    {% endfor %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    <div class="progress {% if task.progress == 100 %}progress-complete{% endif %}">#}
{#                                        <div class="progress-bar" role="progressbar" #}
{#                                             style="width: {{ task.progress }}%;" #}
{#                                             aria-valuenow="{{ task.progress }}" #}
{#                                             aria-valuemin="0" #}
{#                                             aria-valuemax="100"></div>#}
{#                                    </div>#}
{#                                    <div class="text-end small mt-1">{{ task.progress }}%</div>#}
{#                                </td>#}
{#                                <td>${{ task.money_for_task }}</td>#}
{#                                <td>#}
{#                                    {% if task.deadline %}#}
{#                                    <div class="small">{{ task.deadline|date:"d.m.Y" }} - {{ task.deadline|date:"d.m.Y" }}</div>#}
{#                                    {% else %}#}
{#                                    <span class="text-muted small">Нет дедлайна</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    {% if task.task_type == 'SIMPLE' %}#}
{#                                        <span class="badge badge-simple">SIMPLE</span>#}
{#                                    {% elif task.task_type == 'MONTHLY' %}#}
{#                                        <span class="badge badge-simple">MONTHLY</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    <div class="d-flex">#}
{#                                        <form method="post" action="{% url 'delete_task' task.id %}" #}
{#                                              onsubmit="return confirm('Are you sure you want to delete this task?');">#}
{#                                            {% csrf_token %}#}
{#                                            <button type="submit" class="action-btn">#}
{#                                                <i class="fas fa-trash"></i>#}
{#                                            </button>#}
{#                                        </form>#}
{#                                    </div>#}
{#                                </td>#}
{#                            </tr>#}
{#                            {% endfor %}#}
{#                            #}
{#                            {% if show_follow_tasks %}#}
{#                            {% for task in follow_tasks %}#}
{#                            <tr>#}
{#                                <td>#}
{#                                    <div class="d-flex align-items-center">#}
{#                                        <input type="checkbox" class="task-checkbox" {% if task.progress == 100 %}checked{% endif %}>#}
{#                                        {{ task.title }}#}
{#                                    </div>#}
{#                                </td>#}
{#                                <td>#}
{#                                    {% for user in task.assigned_users.all %}#}
{#                                    <div class="small">{{ user.email }}</div>#}
{#                                    {% empty %}#}
{#                                    <span class="text-muted small">Не назначено</span>#}
{#                                    {% endfor %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    <div class="progress {% if task.progress == 100 %}progress-complete{% endif %}">#}
{#                                        <div class="progress-bar" role="progressbar" #}
{#                                             style="width: {{ task.progress }}%;" #}
{#                                             aria-valuenow="{{ task.progress }}" #}
{#                                             aria-valuemin="0" #}
{#                                             aria-valuemax="100"></div>#}
{#                                    </div>#}
{#                                    <div class="text-end small mt-1">{{ task.progress }}%</div>#}
{#                                </td>#}
{#                                <td>${{ task.money_for_task }}</td>#}
{#                                <td>#}
{#                                    {% if task.deadline %}#}
{#                                    <div class="small">{{ task.deadline|date:"d.m.Y" }} - {{ task.deadline|date:"d.m.Y" }}</div>#}
{#                                    {% else %}#}
{#                                    <span class="text-muted small">Нет дедлайна</span>#}
{#                                    {% endif %}#}
{#                                </td>#}
{#                                <td>#}
{#                                    <span class="badge badge-patpis">PATPIS</span>#}
{#                                </td>#}
{#                                <td>#}
{#                                    <div class="d-flex">#}
{#                                        <form method="post" action="{% url 'delete_task' task.id %}" #}
{#                                              onsubmit="return confirm('Are you sure you want to delete this follow task?');">#}
{#                                            {% csrf_token %}#}
{#                                            <button type="submit" class="action-btn">#}
{#                                                <i class="fas fa-trash"></i>#}
{#                                            </button>#}
{#                                        </form>#}
{#                                    </div>#}
{#                                </td>#}
{#                            </tr>#}
{#                            {% endfor %}#}
{#                            {% endif %}#}
{#                        </tbody>#}
{#                    </table>#}
{#                </div>#}
{#                #}
{#                <!-- Sheet View (IMPROVED and LARGER) -->#}
{#                {% if show_follow_tasks %}#}
{#                <div class="sheet-view-container" id="sheet-view" style="display: none;">#}
{#                    <div class="table-responsive">#}
{#                        <table class="sheet-table" id="sheet-table">#}
{#                            <thead>#}
{#                                <tr>#}
{#                                    <th>Задача</th>#}
{#                                    {% for month in all_months %}#}
{#                                        <th>{{ month }}</th>#}
{#                                    {% endfor %}#}
{#                                </tr>#}
{#                            </thead>#}
{#                            <tbody>#}
{#                                {% for row in task_matrix %}#}
{#                                    <tr>#}
{#                                        <td>{{ row.base_name }}</td>#}
{#                                        {% for cell in row.cells %}#}
{#                                            {% if not cell.empty %}#}
{#                                                <td class="progress-cell {% if cell.tasks.0.progress <= 0 %}progress-cell-0{% elif cell.tasks.0.progress <= 25 %}progress-cell-25{% elif cell.tasks.0.progress <= 50 %}progress-cell-50{% elif cell.tasks.0.progress <= 75 %}progress-cell-75{% else %}progress-cell-100{% endif %}" #}
{#                                                    onclick="toggleTaskDetails('detail-{{ row.base_name|slugify }}-{{ forloop.counter }}')">#}
{#                                                    #}
{#                                                    <!-- Simple progress display or task count -->#}
{#                                                    {% if cell.tasks|length == 1 %}#}
{#                                                        <div class="progress-text">{{ cell.tasks.0.progress }}%</div>#}
{#                                                    {% else %}#}
{#                                                        <span class="task-count-badge">{{ cell.tasks|length }}</span>#}
{#                                                    {% endif %}#}
{#                                                    #}
{#                                                    <!-- Task Details Popup -->#}
{#                                                    <div id="detail-{{ row.base_name|slugify }}-{{ forloop.counter }}" class="task-details-popup">#}
{#                                                        {% if cell.tasks|length == 1 %}#}
{#                                                            <!-- Single task details -->#}
{#                                                            <div class="detail-header">#}
{#                                                                <span class="progress-text">{{ cell.tasks.0.progress }}%</span>#}
{#                                                                <form method="post" action="{% url 'delete_task' cell.tasks.0.id %}" #}
{#                                                                    onsubmit="return confirm('Are you sure you want to delete this task?');">#}
{#                                                                    {% csrf_token %}#}
{#                                                                    <button type="submit" class="btn btn-sm btn-outline-danger">#}
{#                                                                        <i class="fas fa-trash"></i>#}
{#                                                                    </button>#}
{#                                                                </form>#}
{#                                                            </div>#}
{#                                                            #}
{#                                                            <div class="detail-row">#}
{#                                                                <span class="detail-label">Оплата:</span>#}
{#                                                                <span class="detail-value">${{ cell.tasks.0.money_for_task }}</span>#}
{#                                                            </div>#}
{#                                                            #}
{#                                                            <div class="detail-row">#}
{#                                                                <span class="detail-label">Дедлайн:</span>#}
{#                                                                <span class="detail-value">{{ cell.tasks.0.deadline|date:"d.m.Y" }}</span>#}
{#                                                            </div>#}
{#                                                            #}
{#                                                            <div>#}
{#                                                                <div class="detail-label">Разработчик:</div>#}
{#                                                                {% for user in cell.tasks.0.assigned_users.all %}#}
{#                                                                    <div>{{ user.email }}</div>#}
{#                                                                {% empty %}#}
{#                                                                    <div>Не назначено</div>#}
{#                                                                {% endfor %}#}
{#                                                            </div>#}
{#                                                        {% else %}#}
{#                                                            <!-- Multiple tasks details -->#}
{#                                                            <div class="detail-header">#}
{#                                                                <span>{{ cell.tasks|length }} задач</span>#}
{#                                                            </div>#}
{#                                                            #}
{#                                                            <div class="multi-task-list">#}
{#                                                                {% for task in cell.tasks %}#}
{#                                                                    <div class="multi-task-item">#}
{#                                                                        <div class="d-flex justify-content-between align-items-center mb-1">#}
{#                                                                            <span class="progress-text">{{ task.progress }}%</span>#}
{#                                                                            <form method="post" action="{% url 'delete_task' task.id %}" #}
{#                                                                                onsubmit="return confirm('Are you sure?');">#}
{#                                                                                {% csrf_token %}#}
{#                                                                                <button type="submit" class="btn btn-sm btn-outline-danger">#}
{#                                                                                    <i class="fas fa-trash"></i>#}
{#                                                                                </button>#}
{#                                                                            </form>#}
{#                                                                        </div>#}
{#                                                                        #}
{#                                                                        <div class="detail-row">#}
{#                                                                            <span class="detail-label">Оплата:</span>#}
{#                                                                            <span class="detail-value">${{ task.money_for_task }}</span>#}
{#                                                                        </div>#}
{#                                                                        #}
{#                                                                        <div>#}
{#                                                                            <span class="detail-label">Разработчик:</span>#}
{#                                                                            {% for user in task.assigned_users.all %}#}
{#                                                                                <div>{{ user.email }}</div>#}
{#                                                                            {% empty %}#}
{#                                                                                <div>Не назначено</div>#}
{#                                                                            {% endfor %}#}
{#                                                                        </div>#}
{#                                                                    </div>#}
{#                                                                {% endfor %}#}
{#                                                            </div>#}
{#                                                        {% endif %}#}
{#                                                    </div>#}
{#                                                </td>#}
{#                                            {% else %}#}
{#                                                <td class="text-center text-muted">-</td>#}
{#                                            {% endif %}#}
{#                                        {% endfor %}#}
{#                                    </tr>#}
{#                                {% endfor %}#}
{#                            </tbody>#}
{#                        </table>#}
{#                    </div>#}
{#                </div>#}
{#                {% endif %}#}
{#                #}
{#                <!-- Pagination -->#}
{#                {% if regular_tasks.has_other_pages or follow_tasks.has_other_pages %}#}
{#                <nav aria-label="Task pagination" class="d-flex justify-content-center mb-4">#}
{#                    <ul class="pagination">#}
{#                        {% if regular_tasks.has_previous %}#}
{#                        <li class="page-item">#}
{#                            <a class="page-link" href="?page={{ regular_tasks.previous_page_number }}">&laquo;</a>#}
{#                        </li>#}
{#                        {% else %}#}
{#                        <li class="page-item disabled">#}
{#                            <span class="page-link">&laquo;</span>#}
{#                        </li>#}
{#                        {% endif %}#}
{##}
{#                        {% for i in regular_tasks.paginator.page_range %}#}
{#                        <li class="page-item {% if regular_tasks.number == i %}active{% endif %}">#}
{#                            <a class="page-link" href="?page={{ i }}">{{ i }}</a>#}
{#                        </li>#}
{#                        {% endfor %}#}
{##}
{#                        {% if regular_tasks.has_next %}#}
{#                        <li class="page-item">#}
{#                            <a class="page-link" href="?page={{ regular_tasks.next_page_number }}">&raquo;</a>#}
{#                        </li>#}
{#                        {% else %}#}
{#                        <li class="page-item disabled">#}
{#                            <span class="page-link">&raquo;</span>#}
{#                        </li>#}
{#                        {% endif %}#}
{#                    </ul>#}
{#                </nav>#}
{#                {% endif %}#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{##}
{#    <!-- Bootstrap JS -->#}
{#    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>#}
{#    #}
{#    <!-- Sheet View Toggle Script -->#}
{#    <script>#}
{#        document.addEventListener('DOMContentLoaded', function() {#}
{#            const listViewBtn = document.getElementById('list-view-btn');#}
{#            const sheetViewBtn = document.getElementById('sheet-view-btn');#}
{#            const listView = document.getElementById('list-view');#}
{#            const sheetView = document.getElementById('sheet-view');#}
{#            #}
{#            if (listViewBtn && sheetViewBtn) {#}
{#                listViewBtn.addEventListener('click', function() {#}
{#                    listView.style.display = 'block';#}
{#                    sheetView.style.display = 'none';#}
{#                    listViewBtn.classList.add('active');#}
{#                    sheetViewBtn.classList.remove('active');#}
{#                });#}
{#                #}
{#                sheetViewBtn.addEventListener('click', function() {#}
{#                    listView.style.display = 'none';#}
{#                    sheetView.style.display = 'block';#}
{#                    sheetViewBtn.classList.add('active');#}
{#                    listViewBtn.classList.remove('active');#}
{#                    #}
{#                    // Force the current month highlighting when sheet view is shown#}
{#                    highlightCurrentMonth();#}
{#                });#}
{#            }#}
{#        });#}
{#        #}
{#        // Function to toggle task details popups#}
{#        function toggleTaskDetails(detailId) {#}
{#            const detailElement = document.getElementById(detailId);#}
{#            #}
{#            // First close any other open popups#}
{#            document.querySelectorAll('.task-details-popup').forEach(popup => {#}
{#                if (popup.id !== detailId) {#}
{#                    popup.style.display = 'none';#}
{#                }#}
{#            });#}
{#            #}
{#            // Toggle this popup#}
{#            if (detailElement) {#}
{#                if (detailElement.style.display === 'block') {#}
{#                    detailElement.style.display = 'none';#}
{#                } else {#}
{#                    detailElement.style.display = 'block';#}
{#                }#}
{#            }#}
{#            #}
{#            // Prevent the event from bubbling up#}
{#            event.stopPropagation();#}
{#        }#}
{#        #}
{#        // Close popups when clicking elsewhere on the document#}
{#        document.addEventListener('click', function(event) {#}
{#            if (!event.target.closest('.progress-cell')) {#}
{#                document.querySelectorAll('.task-details-popup').forEach(popup => {#}
{#                    popup.style.display = 'none';#}
{#                });#}
{#            }#}
{#        });#}
{#        #}
{#        // Function to highlight current month#}
{#        function highlightCurrentMonth() {#}
{#            // Get current date in format "Month Year" (e.g., "March 2025")#}
{#            const now = new Date();#}
{#            const currentMonthName = now.toLocaleString('en-US', { month: 'long' });#}
{#            const currentYear = now.getFullYear();#}
{#            const currentMonthFull = currentMonthName + ' ' + currentYear;#}
{#            #}
{#            // Clear any existing highlights first#}
{#            document.querySelectorAll('.current-month, .current-month-cell').forEach(el => {#}
{#                el.classList.remove('current-month');#}
{#                el.classList.remove('current-month-cell');#}
{#            });#}
{#            #}
{#            // Find and highlight the current month in the header#}
{#            const table = document.getElementById('sheet-table');#}
{#            if (!table) return;#}
{#            #}
{#            const headers = table.querySelectorAll('th');#}
{#            let currentMonthIndex = -1;#}
{#            #}
{#            // Search for exact match first#}
{#            headers.forEach((header, index) => {#}
{#                if (index > 0) { // Skip first header (task name)#}
{#                    const headerText = header.textContent.trim();#}
{#                    if (headerText === currentMonthFull) {#}
{#                        header.classList.add('current-month');#}
{#                        currentMonthIndex = index;#}
{#                    }#}
{#                }#}
{#            });#}
{#            #}
{#            // If no exact match, try partial match (just month name)#}
{#            if (currentMonthIndex === -1) {#}
{#                headers.forEach((header, index) => {#}
{#                    if (index > 0) { // Skip first header#}
{#                        const headerText = header.textContent.trim();#}
{#                        if (headerText.includes(currentMonthName)) {#}
{#                            header.classList.add('current-month');#}
{#                            currentMonthIndex = index;#}
{#                        }#}
{#                    }#}
{#                });#}
{#            }#}
{#            #}
{#            // If we found a match, highlight the column cells#}
{#            if (currentMonthIndex !== -1) {#}
{#                const rows = table.querySelectorAll('tbody tr');#}
{#                rows.forEach(row => {#}
{#                    const cells = row.querySelectorAll('td');#}
{#                    if (cells.length > currentMonthIndex) {#}
{#                        // currentMonthIndex is 1-based in the header, but cells[0] is the task name cell#}
{#                        cells[currentMonthIndex].classList.add('current-month-cell');#}
{#                    }#}
{#                });#}
{#            } else {#}
{#                // Force highlight March 2025 (or whatever month you need to highlight)#}
{#                headers.forEach((header, index) => {#}
{#                    if (index > 0) { // Skip first header#}
{#                        const headerText = header.textContent.trim();#}
{#                        if (headerText === "March 2025") {#}
{#                            header.classList.add('current-month');#}
{#                            currentMonthIndex = index;#}
{#                        }#}
{#                    }#}
{#                });#}
{#                #}
{#                // Highlight cells if we found March 2025#}
{#                if (currentMonthIndex !== -1) {#}
{#                    const rows = table.querySelectorAll('tbody tr');#}
{#                    rows.forEach(row => {#}
{#                        const cells = row.querySelectorAll('td');#}
{#                        if (cells.length > currentMonthIndex) {#}
{#                            cells[currentMonthIndex].classList.add('current-month-cell');#}
{#                        }#}
{#                    });#}
{#                }#}
{#            }#}
{#            #}
{#            console.log('Current month highlighting applied');#}
{#        }#}
{#        #}
{#        // Run the highlighter when page loads#}
{#        document.addEventListener('DOMContentLoaded', function() {#}
{#            // Add a small delay to ensure the table is fully rendered#}
{#            setTimeout(highlightCurrentMonth, 100);#}
{#        });#}
{#    </script>#}
{#</body>#}
{#</html>#}